<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>REST service - graphANNIS documentation</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="expanded "><a href="data-model.html"><strong aria-hidden="true">2.</strong> Data model</a></li><li><ol class="section"><li class="expanded "><a href="annotation-graph.html"><strong aria-hidden="true">2.1.</strong> Annotations as graph</a></li><li class="expanded "><a href="data-model-indexes.html"><strong aria-hidden="true">2.2.</strong> Indexes for faster query execution</a></li></ol></li><li class="expanded "><a href="embed.html"><strong aria-hidden="true">3.</strong> How to embed into applications</a></li><li><ol class="section"><li class="expanded "><a href="embed-python.html"><strong aria-hidden="true">3.1.</strong> Python Tutorial</a></li><li class="expanded "><a href="embed-java.html"><strong aria-hidden="true">3.2.</strong> Java Tutorial</a></li><li class="expanded "><a href="embed-rust.html"><strong aria-hidden="true">3.3.</strong> Rust Tutorial</a></li></ol></li><li class="expanded "><a href="rest.html" class="active"><strong aria-hidden="true">4.</strong> REST service</a></li><li class="expanded "><a href="cli.html"><strong aria-hidden="true">5.</strong> Interactive command-line</a></li><li class="expanded "><a href="release-checklist.html"><strong aria-hidden="true">6.</strong> Release checklist</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">graphANNIS documentation</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#rest-service" id="rest-service">REST service</a></h1>
<p>GraphANNIS includes a tool to start a complete REST service that can be used to query and administrate corpora.
The <a href="https://github.com/korpling/ANNIS">ANNIS web-frontend</a> uses this REST service for executing the AQL searches.
Using this REST service, it is also possible to implement a custom AQL web-interface e.g. for a specific corpus or analysis workflow with minimal effort.
In addition to <a href="./embed.html">using graphANNIS as a library in you application</a>, the REST API allows you to implement a web interface for a remote graphANNIS server.</p>
<p>You can just execute the <code>graphannis-webservice</code> executable<sup class="footnote-reference"><a href="#rename">1</a></sup> to start a web-server with default settings and on port 5711 which will listen to requests from <code>localhost</code>.
SSL is not supported, so if you want to make the service accessible from the outside you should use a proxy server with encryption enabled and a valid certificate.</p>
<p>The graphANNIS REST API is specified and documented in <a href="https://swagger.io/docs/specification/about/">OpenAPI 3</a>.
The specification file can also be used to auto-generate client code, e.g. with the <a href="https://github.com/OpenAPITools/openapi-generator#overview">OpenAPI Generator</a>.
The rendered documentation (in Markdown) is <a href="https://github.com/korpling/graphANNIS/tree/develop/webservice/docs/">included in the repository</a>.</p>
<h2><a class="header" href="#configuration" id="configuration">Configuration</a></h2>
<p>The executable takes a <code>--config</code> argument, which must point to a configuration file in the <a href="https://toml.io">TOML format</a>.</p>
<p>The following is an example file with most settings set to their default value.</p>
<pre><code class="language-toml">[bind]
port = 5711
host = &quot;localhost&quot;

[database]
graphannis = &quot;data/&quot;
sqlite = &quot;service.sqlite&quot;
disk_based = false

[logging]
debug = false

[auth]
jwt_secret = &quot;&quot;
expiration_minutes = 120

[users.test]
password = &quot;$2y$10$XNyTts7Hc83ME99hKOAo.uvY4H67G1JJRtBlloQx7nDFKwnLfoQmS&quot;
admin = true
groups = [&quot;internal&quot;, &quot;non-commercial&quot;]
</code></pre>
<h3><a class="header" href="#bind-section" id="bind-section">[bind] section</a></h3>
<p>This section describes to what <code>port</code> and <code>host</code> name the server should bind to.</p>
<h3><a class="header" href="#database-section" id="database-section">[database] section</a></h3>
<p>GraphANNIS needs to know where the data directory is located, which must be a path given by the value for the <code>graphannis</code> key and must point to a directory on the file system of the server.
For configuration unique to the REST service, a small SQLite database is used, which path is given in the value for the <code>sqlite</code> key.
A new database file will be created at this path when the service is started and the file does not exist yet.
Also, you can decide if you want to prefer disk-based storage of annotations by setting the value for the <code>disk_based</code> key to <code>true</code>.</p>
<h3><a class="header" href="#logging-section" id="logging-section">[logging] section</a></h3>
<p>Per default, graphANNIS will only output information, warning and error messages.
To also enable debug output, set the value for the <code>debug</code> field to <code>true</code>.</p>
<h3><a class="header" href="#authentication-and-authorization" id="authentication-and-authorization">Authentication and authorization</a></h3>
<p>The graphANNIS service uses <a href="https://jwt.io/">JSON Web Tokens (JWT)</a> to authorize access to restricted parts of the REST API.
The authorization is performed using these tokens and graphANNIS requires certain claims as payload, but how they are generated is up to the administrator of the service.
For complex authentication and authorization scenarios, like logging in using an institutional account or using e.g. Google or Facebook accounts, you can use an external commercial service like e.g. <a href="Auth0">https://auth0.com/</a> or install an open source solution like <a href="https://www.keycloak.org/">Keycloak</a> to generate the secret tokens.
Your application will redirect to the login-page provided by these services when the user wants to login.
These services then generate a JWT token which should be used as Bearer-Token in the <code>Authorization</code> header of each HTTP request to the API.</p>
<p>For an JWT token to be accepted, it must be signed with the HMAC with SHA-256 (HS256) algorithm and a shared secret.
Create a random secret and add this secret as value to the <code>jwt_secret</code> key in the <code>[auth]</code> section in the graphANNIS configuration and in the external JWT token provider service.</p>
<h4><a class="header" href="#claims" id="claims">Claims</a></h4>
<p>JWT tokens can contain the following claims:</p>
<ul>
<li><code>sub</code> (mandatory): The subject the token was issued to.</li>
<li><code>groups</code>: A possible empty list of strings to which corpus groups the subject belongs to. All users (even when not logged-in) are part of the <code>anonymous</code> group. You can use the API to configure which groups have access to which corpus.</li>
<li><code>exp</code>: An optional expiration date as unix timestamp in seconds since epoch and UTC.</li>
<li><code>admin</code>: If true, this user is an adminstrator.</li>
</ul>
<h4><a class="header" href="#local-accounts" id="local-accounts">Local accounts</a></h4>
<p>In addition to using an external token provider, you can configure local accounts based on usernames and passwords.
This can be e.g. useful to add a local administrator account when the token provider does not allow to add a <code>admin</code> claim.
GraphANNIS provides a simple REST API to generate JWT tokens for these local accounts.
The <code>expiration_minutes</code> key in the <code>[auth]</code> section allows you to configure how long a JWT token will be valid which was issued for local accounts.</p>
<p>To add a user, add a <code>[users.&lt;name&gt;]</code> section and add the values for the following keys:</p>
<ul>
<li>
<p><code>password</code>: A bcrypt hash for the password, can be e.g. generated with <code>htpasswd -BnC 10 username</code> on Linux.</p>
</li>
<li>
<p><code>admin</code>: If <code>true</code>, this user is an adminstrator.</p>
</li>
<li>
<p><code>groups</code>: A list of corpus groups the user is part of.</p>
</li>
<div class="footnote-definition" id="rename"><sup class="footnote-definition-label">1</sup>
<p>When downloading a binary from the release page, on MacOS you might need to rename the downloaded file from <code>graphannis-webservice.osx</code> to <code>graphannis-webservice</code>. The executable is called <code>graphannis-webservice.exe</code> on Windows.</p>
</div>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="embed-rust.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="cli.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="embed-rust.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="cli.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
